[â† è¿”å›ä¸»é ](../README.md)

# æ•ˆèƒ½æ¸¬è©¦ç³»çµ±å¯¦ä½œç¸½çµ

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. SQL è³‡æ–™ç®¡ç†è…³æœ¬
**æª”æ¡ˆ:** `scripts/generate_test_data.sql`

æä¾›çš„ PostgreSQL å‡½æ•¸:
- âœ… `generate_test_data(count)` - å¿«é€Ÿç”¢ç”Ÿæ¸¬è©¦è³‡æ–™
- âœ… `clear_all_data()` - æ¸…ç©ºæ‰€æœ‰è³‡æ–™
- âœ… `get_data_stats()` - å–å¾—è³‡æ–™çµ±è¨ˆ (ç­†æ•¸ã€è¡¨æ ¼å¤§å°ã€ç´¢å¼•å¤§å°)
- âœ… `rebuild_indexes()` - é‡å»º trigram ç´¢å¼•

### 2. å¾Œç«¯ç®¡ç† API
**æª”æ¡ˆ:** `backend/server.js`

æ–°å¢çš„ API ç«¯é»:
- âœ… `GET /admin/data/stats` - å–å¾—è³‡æ–™çµ±è¨ˆ
- âœ… `POST /admin/data/generate` - ç”¢ç”ŸæŒ‡å®šæ•¸é‡çš„æ¸¬è©¦è³‡æ–™
- âœ… `DELETE /admin/data/clear` - æ¸…ç©ºæ‰€æœ‰è³‡æ–™
- âœ… `POST /admin/data/rebuild-indexes` - é‡å»ºç´¢å¼•

### 3. æœå°‹ API æ•ˆèƒ½ç›£æ§
**æª”æ¡ˆ:** `backend/server.js`

ä¿®æ”¹çš„åŠŸèƒ½:
- âœ… æœå°‹ API ç¾åœ¨å›å‚³æŸ¥è©¢åŸ·è¡Œæ™‚é–“ (`queryTimeMs`)
- âœ… æ–°çš„å›æ‡‰æ ¼å¼åŒ…å« `results` å’Œ `meta` è³‡è¨Š

å›æ‡‰ç¯„ä¾‹:
```json
{
  "results": [...],
  "meta": {
    "queryTimeMs": 45,
    "resultCount": 20,
    "query": "test"
  }
}
```

### 4. k6 è² è¼‰æ¸¬è©¦è…³æœ¬
**æª”æ¡ˆ:** `k6-tests/search-performance.js`

åŠŸèƒ½:
- âœ… æ”¯æ´å¤šç¨®æ¸¬è©¦å ´æ™¯ (smoke, load, stress, spike)
- âœ… è‡ªå‹•æª¢æŸ¥æœå‹™å¥åº·ç‹€æ…‹
- âœ… è¨˜éŒ„è©³ç´°çš„æ•ˆèƒ½æŒ‡æ¨™ (p50, p95, p99)
- âœ… æ¨¡æ“¬çœŸå¯¦ä½¿ç”¨è€…è¡Œç‚º (éš¨æ©Ÿæœå°‹é—œéµå­—)
- âœ… å¯è‡ªè¨‚ç›®æ¨™ URL å’Œå ´æ™¯

### 5. è‡ªå‹•åŒ–æ¸¬è©¦è…³æœ¬
**æª”æ¡ˆ:** `scripts/run-performance-tests.sh`

åŠŸèƒ½:
- âœ… è‡ªå‹•æ¸¬è©¦å¤šå€‹è³‡æ–™é‡ç´šåˆ¥ (é è¨­: 1è¬, 5è¬, 10è¬)
- âœ… æ¯å€‹ç´šåˆ¥è‡ªå‹•åŸ·è¡Œ k6 æ¸¬è©¦
- âœ… ç”¢ç”Ÿè©³ç´°çš„æ•ˆèƒ½æ¯”è¼ƒå ±å‘Š
- âœ… å½©è‰²è¼¸å‡ºå’Œé€²åº¦é¡¯ç¤º
- âœ… å‰ç½®æª¢æŸ¥ (æœå‹™ç‹€æ…‹ã€k6 å®‰è£)

### 6. å‰ç«¯ç®¡ç†é¢æ¿
**æª”æ¡ˆ:** `frontend/index.html`

æ–°å¢åŠŸèƒ½:
- âœ… å¯æ‘ºç–Šçš„ç®¡ç†é¢æ¿
- âœ… å³æ™‚è³‡æ–™çµ±è¨ˆé¡¯ç¤º (ç¸½ç­†æ•¸ã€è¡¨æ ¼å¤§å°ã€ç´¢å¼•å¤§å°)
- âœ… ä¸€éµç”¢ç”Ÿæ¸¬è©¦è³‡æ–™ (1è¬/5è¬/10è¬)
- âœ… æ¸…ç©ºè³‡æ–™åŠŸèƒ½
- âœ… é‡å»ºç´¢å¼•åŠŸèƒ½
- âœ… æœå°‹çµæœé¡¯ç¤ºæŸ¥è©¢æ™‚é–“
- âœ… æ“ä½œå›é¥‹è¨Šæ¯ (æˆåŠŸ/å¤±æ•—/é€²è¡Œä¸­)

### 7. æ¸¬è©¦æ–‡ä»¶
**æª”æ¡ˆ:** 
- âœ… `PERFORMANCE_TEST.md` - å®Œæ•´çš„æ•ˆèƒ½æ¸¬è©¦æŒ‡å—
- âœ… `PERFORMANCE_TEST_QUICKSTART.md` - å¿«é€Ÿé–‹å§‹æŒ‡å—

å…§å®¹åŒ…å«:
- k6 å®‰è£èªªæ˜
- æ‰‹å‹•æ¸¬è©¦æ­¥é©Ÿ
- è‡ªå‹•åŒ–æ¸¬è©¦èªªæ˜
- æ¸¬è©¦å ´æ™¯ä»‹ç´¹
- æ•ˆèƒ½æŒ‡æ¨™è§£é‡‹
- é æœŸæ•ˆèƒ½åŸºæº–
- ç–‘é›£æ’è§£

## ğŸ¯ ä½¿ç”¨æ–¹å¼

### æ–¹å¼ 1: è‡ªå‹•åŒ–æ¸¬è©¦ (æ¨è–¦)

```bash
# è³¦äºˆåŸ·è¡Œæ¬Šé™
chmod +x scripts/run-performance-tests.sh

# åŸ·è¡Œæ¸¬è©¦
./scripts/run-performance-tests.sh
```

### æ–¹å¼ 2: å‰ç«¯ç®¡ç†é¢æ¿

1. é–‹å•Ÿ http://localhost:3000
2. é»æ“Š "âš™ï¸ ç®¡ç†é¢æ¿" â†’ "é¡¯ç¤º"
3. é»æ“Š "ç”¢ç”Ÿ X è¬ç­†" æŒ‰éˆ•
4. åœ¨æœå°‹æ¡†æ¸¬è©¦æœå°‹æ•ˆèƒ½
5. è§€å¯ŸæŸ¥è©¢æ™‚é–“

### æ–¹å¼ 3: æ‰‹å‹• API æ¸¬è©¦

```bash
# ç”¢ç”Ÿè³‡æ–™
curl -X POST http://localhost:3000/admin/data/generate \
  -H "Content-Type: application/json" \
  -d '{"count": 10000}'

# åŸ·è¡Œ k6 æ¸¬è©¦
k6 run k6-tests/search-performance.js

# æŸ¥çœ‹çµ±è¨ˆ
curl http://localhost:3000/admin/data/stats
```

## ğŸ“Š æ¸¬è©¦è³‡æ–™ç”¢ç”Ÿæ–¹å¼

ä½¿ç”¨ `md5(random()::text)` ç”¢ç”Ÿéš¨æ©Ÿå­—ä¸²:

```sql
INSERT INTO worlds (title, description)
SELECT
    md5(random()::text) AS title,
    md5(random()::text) || ' ' || md5(random()::text) AS description
FROM generate_series(1, 100000);
```

**å„ªé»:**
- âš¡ éå¸¸å¿«é€Ÿ (10è¬ç­†ç´„ 10-15 ç§’)
- ğŸ¯ ç²¾ç¢ºæ§åˆ¶è³‡æ–™é‡
- ğŸ’» å®Œå…¨æœ¬åœ°åŸ·è¡Œ,ä¸éœ€å¤–éƒ¨ API

**æ³¨æ„äº‹é …:**
- ç”¢ç”Ÿçš„æ˜¯äº‚ç¢¼ (32 å­—å…ƒ MD5 hash)
- é©åˆæ¸¬è©¦**è³‡æ–™é‡å°æ•ˆèƒ½çš„å½±éŸ¿**
- ä¸é©åˆæ¸¬è©¦çœŸå¯¦æœå°‹å ´æ™¯ (å› ç‚ºæ²’æœ‰çœŸå¯¦å–®å­—)

## ğŸ”§ æŠ€è¡“ç´°ç¯€

### PostgreSQL å‡½æ•¸
- ä½¿ç”¨ `clock_timestamp()` ç²¾ç¢ºæ¸¬é‡åŸ·è¡Œæ™‚é–“
- ä½¿ç”¨ `pg_size_pretty()` æ ¼å¼åŒ–å¤§å°é¡¯ç¤º
- ä½¿ç”¨ `generate_series()` å¿«é€Ÿç”¢ç”Ÿå¤§é‡è³‡æ–™

### k6 æ¸¬è©¦
- æ”¯æ´ 4 ç¨®æ¸¬è©¦å ´æ™¯ (smoke/load/stress/spike)
- ä½¿ç”¨ç’°å¢ƒè®Šæ•¸é…ç½® (`SCENARIO`, `BASE_URL`)
- è¼¸å‡º JSON æ ¼å¼çµæœä¾›å¾ŒçºŒåˆ†æ

### å‰ç«¯ç®¡ç†é¢æ¿
- ä½¿ç”¨åŸç”Ÿ JavaScript (ç„¡æ¡†æ¶ä¾è³´)
- RESTful API æ•´åˆ
- å³æ™‚æ›´æ–°çµ±è¨ˆè³‡è¨Š
- å‹å–„çš„éŒ¯èª¤è™•ç†å’Œä½¿ç”¨è€…å›é¥‹

## ğŸ“ˆ é æœŸæ•ˆèƒ½åŸºæº–

| è³‡æ–™é‡ | è¡¨æ ¼å¤§å° | ç´¢å¼•å¤§å° | p95 å›æ‡‰æ™‚é–“ | p99 å›æ‡‰æ™‚é–“ |
|--------|----------|----------|--------------|--------------|
| 1 è¬   | ~1 MB    | ~800 KB  | < 50ms       | < 100ms      |
| 5 è¬   | ~5 MB    | ~4 MB    | < 100ms      | < 200ms      |
| 10 è¬  | ~10 MB   | ~8 MB    | < 150ms      | < 300ms      |

*å¯¦éš›çµæœæœƒå› ç¡¬é«”é…ç½®è€Œç•°*

## ğŸ“ ä¸‹ä¸€æ­¥å»ºè­°

1. **æ¸¬è©¦æ›´å¤§è³‡æ–™é‡**
   - 20 è¬ç­†
   - 50 è¬ç­†
   - 100 è¬ç­†

2. **æ¸¬è©¦çœŸå¯¦è³‡æ–™**
   - ä½¿ç”¨ç¾æœ‰çš„ `scripts/seed.py` ç”¢ç”ŸçœŸå¯¦çš„æ›¸ç±/è«–æ–‡è³‡æ–™
   - æ¯”è¼ƒäº‚ç¢¼è³‡æ–™ vs çœŸå¯¦è³‡æ–™çš„æ•ˆèƒ½å·®ç•°

3. **å„ªåŒ–é…ç½®**
   - èª¿æ•´ PostgreSQL è¨˜æ†¶é«”è¨­å®š
   - æ¸¬è©¦ä¸åŒçš„ç´¢å¼•ç­–ç•¥ (GIN vs GiST)
   - èª¿æ•´é€£ç·šæ± å¤§å°

4. **é€²éšæ¸¬è©¦**
   - æ•´åˆ Grafana + InfluxDB è¦–è¦ºåŒ–
   - æ¸¬è©¦ä¸åŒæŸ¥è©¢é¡å‹çš„æ•ˆèƒ½
   - ä¸¦ç™¼å¯«å…¥æ¸¬è©¦

## ğŸ“š ç›¸é—œæ–‡ä»¶

- `PERFORMANCE_TEST.md` - å®Œæ•´æ•ˆèƒ½æ¸¬è©¦æŒ‡å—
- `PERFORMANCE_TEST_QUICKSTART.md` - å¿«é€Ÿé–‹å§‹æŒ‡å—
- `README.md` - å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
- `API_TEST_REPORT.md` - API æ¸¬è©¦å ±å‘Š

## âœ¨ ç¸½çµ

å·²æˆåŠŸå»ºç«‹å®Œæ•´çš„æ•ˆèƒ½æ¸¬è©¦ç³»çµ±,åŒ…å«:
- âœ… SQL è³‡æ–™ç®¡ç†å‡½æ•¸
- âœ… RESTful ç®¡ç† API
- âœ… k6 å°ˆæ¥­è² è¼‰æ¸¬è©¦
- âœ… è‡ªå‹•åŒ–æ¸¬è©¦è…³æœ¬
- âœ… å‰ç«¯ç®¡ç†ä»‹é¢
- âœ… è©³ç´°æ¸¬è©¦æ–‡ä»¶

ç¾åœ¨å¯ä»¥è¼•é¬†æ¸¬è©¦ä¸åŒè³‡æ–™é‡å° pg_trgm æœå°‹æ•ˆèƒ½çš„å½±éŸ¿! ğŸ‰

